# Database Structure and Data Retrieval

## Database Composition

The database is composed of four main collections, each corresponding to a MongoDB model:

1. **Vineyard Collection**
   - _id: String (alias: vineyardName)
   - vineyardArea: String
   - vineyard: String
   - contactPersonVineYard: String

2. **Truck Collection**
   - _id: String (alias: vehiclePlate)
   - conductor: String
   - driverPhone: String
   - typeOfTruck: String
   - emptyWeight: Number (optional)

3. **Shipment Collection**
   - _id: ObjectId (automatically generated by MongoDB)
   - shipmentNumber: Date
   - statusOfShipment: String (enum of predefined statuses)
   - fullTruckWeight: Number
   - IsAutomaticEntryAnnotations: Boolean
   - receivingTemperature: Number
   - arrivalTime: Date
   - departureTime: Date
   - receivingTank: String
   - sentBy: String
   - comments: String
   - scrambled: Boolean
   - rotten: Boolean
   - sulfitAdded1: Boolean
   - sulfitAdded2: Boolean
   - ensimesAdded: Boolean
   - ph: Number
   - sugarLevel: Number
   - acidityLevel: Number
   - alcoholContent: Number
   - colorIntensity: Number
   - aromaProfile: String
   - totalWeight: Number
   - harvestDate: Date
   - shipmentDate: Date
   - isManualHarvest: Boolean
   - grapeVariety: String
   - isKosher: Boolean
   - isAuthorized: Boolean
   - vineyardName: String (reference to Vineyard)
   - containers: Number
   - vehiclePlate: String (reference to Truck)

4. **User Collection**
   - _id: ObjectId (automatically generated by MongoDB)
   - username: String
   - password: String
   - role: String

## Data Retrieval Process

The information is retrieved through API endpoints that query the MongoDB database using Mongoose. Here's how each piece of information is obtained:

1. **Driver Payment Calculation**
   - Endpoint: `/api/driver-payment/:vehiclePlate`
   - Process:
     1. The API receives a vehicle plate number.
     2. It queries the Shipment collection for all shipments with the given vehicle plate.
     3. For each shipment, it calculates the weight transported (fullTruckWeight - emptyTruckWeight).
     4. The payment is calculated based on the total weight transported (e.g., $0.1 per kg).

2. **Vineyard Payment Calculation**
   - Endpoint: `/api/vineyard-payment/:vineyardName`
   - Process:
     1. The API receives a vineyard name.
     2. It queries the Shipment collection for all shipments from the given vineyard.
     3. For each shipment, it calculates the payment based on weight and quality factors (e.g., pH level).
     4. The total payment is summed up for all shipments.

3. **Laboratory Results Retrieval**
   - Endpoint: `/api/lab-results/:vineyardName`
   - Process:
     1. The API receives a vineyard name.
     2. It queries the Shipment collection for all shipments from the given vineyard.
     3. For each shipment, it extracts the relevant laboratory data (pH, sugar level, acidity level, etc.).
     4. The data is compiled into a list of results and sent back to the client.

## Data Flow

1. The frontend React component makes axios requests to these API endpoints.
2. The backend Express server receives these requests and processes them using the appropriate Mongoose queries.
3. Mongoose interacts with the MongoDB database to retrieve or calculate the necessary data.
4. The results are sent back to the frontend, where they are displayed in the React component.

This structure allows for efficient data retrieval and calculation, with the heavy lifting done on the server-side while keeping the frontend responsive and focused on presentation.







17/09/2024
agregue carpeta "prueba" dentro de carpeta "server" donde hay un server ejemplo, y en VineyardAnalysis.jsx su lado frontend --estudiar bien estos componentes , organizarlos segun carpetas, y usar lo aprendido para el resto de la aplicacion.
